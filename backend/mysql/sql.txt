SET NAMES 'UTF8';
SET CHARACTER SET 'UTF8';
CREATE TABLE IF NOT EXISTS tasks (
 id int NOT NULL AUTO_INCREMENT,
 title VARCHAR(255) COLLATE utf8_unicode_ci,
 text VARCHAR(255) COLLATE utf8_unicode_ci,
 deadline DATETIME,
 PRIMARY KEY (id)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

/* DATETIME YYYY-MM-DD hh:mm:ss */

INSERT INTO tasks (title, text, deadline) 
values('Мое первое дело', 'Описание из много букв', '2021-12-10'),
('Мое второе дело', 'Описание второго дела из много букв', '2021-12-11 12:00:00'),
('Моя мечта', 'Хочу совершить восхождение на Эверест!', '2022-04-11 08:00:00');

ALTER TABLE tasks ADD status VARCHAR(50) COLLATE utf8_unicode_ci AFTER deadline;

CREATE TABLE IF NOT EXISTS sections (
  id INT NOT NULL AUTO_INCREMENT,
  name VARCHAR(255) COLLATE utf8_unicode_ci,
  icon VARCHAR(255) COLLATE utf8_unicode_ci,
  PRIMARY KEY (id)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

INSERT INTO sections (name)
VALUES('relations'),
('career'),
('growth'),
('finance'),
('spiritual'),
('health'),
('sports'),
('relax');

ALTER TABLE tasks ADD COLUMN section_id INT NULL AFTER status;

ALTER TABLE tasks ADD CONSTRAINT fk_task_section
FOREIGN KEY (section_id)
REFERENCES sections (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION;

ALTER TABLE sections ADD color VARCHAR(100) COLLATE utf8_unicode_ci AFTER icon;

ALTER TABLE sections ADD num INT AFTER color;

ALTER TABLE sections RENAME categories;

UPDATE categories SET color = '#f5f5e2', num = 0 WHERE id = 1;
UPDATE categories SET color = 'rgba(204,102,0,0.23)', num = 0 WHERE id = 2;
UPDATE categories SET color = 'rgba(255,51,51,0.42)', num = 0 WHERE id = 3;
UPDATE categories SET color = 'rgba(204,102,153,0.4)', num = 0 WHERE id = 4;
UPDATE categories SET color = 'rgba(153,0,255,0.42)', num = 0 WHERE id = 5;
UPDATE categories SET color = 'rgba(51,102,204,0.47)', num = 0 WHERE id = 6;
UPDATE categories SET color = 'rgba(0,204,204,0.3)', num = 0 WHERE id = 7;
UPDATE categories SET color = 'rgba(51,153,51,0.29)', num = 0 WHERE id = 8;

CREATE TABLE IF NOT EXISTS goals (
 id INT NOT NULL AUTO_INCREMENT,
 title VARCHAR(255) COLLATE utf8_unicode_ci,
 text VARCHAR(255) COLLATE utf8_unicode_ci,
 deadline DATETIME,
 PRIMARY KEY (id)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

/* Удалить внешний ключ */
ALTER TABLE tasks DROP FOREIGN KEY section_id;

ALTER TABLE goals ADD COLUMN category_id INT NOT NULL AFTER deadline;

ALTER TABLE goals ADD CONSTRAINT fk_goal_category
FOREIGN KEY (category_id)
REFERENCES categories (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION;

ALTER TABLE tasks ADD COLUMN goal_id INT NOT NULL AFTER status;

ALTER TABLE tasks DROP section_id;

ALTER TABLE tasks ADD CONSTRAINT fk_goal_id
FOREIGN KEY (goal_id)
REFERENCES goals (id)
ON DELETE NO ACTION
ON UPDATE NO ACTION;